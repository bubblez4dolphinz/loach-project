"0","# Define factor levels"
"0","treatment_levels <- c(""bg"", ""both"")"
"0","species_levels <- c(""Botia_lohachata"", ""Yasuhikotakia_modesta"")"
"0","direction_levels <- c(""left"", ""right"")"
"0","group_levels <- c("
"0","  ""left_Botia_lohachata_bg"", ""left_Botia_lohachata_both"","
"0","  ""left_Yasuhikotakia_modesta_bg"", ""left_Yasuhikotakia_modesta_both"","
"0","  ""right_Botia_lohachata_bg"", ""right_Botia_lohachata_both"","
"0","  ""right_Yasuhikotakia_modesta_bg"", ""right_Yasuhikotakia_modesta_both"""
"0",")"
"0",""
"0","# Main data transformation pipeline"
"0","df <- EMDOverlay_clipsummary %>%"
"0","  # Parse metadata from FullClipName"
"0","  mutate("
"0","    treatment = case_when("
"0","      grepl(""^bg_"", FullClipName) ~ ""bg"","
"0","      grepl(""^both_"", FullClipName) ~ ""both"","
"0","      TRUE ~ NA_character_"
"0","    ),"
"0","    Species = str_extract(FullClipName, ""(?<=^(bg_|both_))[^_]+_[^_]+""),"
"0","    Direction = case_when("
"0","      real_direction == 270 ~ ""left"","
"0","      real_direction == 90 ~ ""right"","
"0","      TRUE ~ NA_character_"
"0","    )"
"0","  ) %>%"
"0","  # Filter out unusable rows"
"0","  filter(!is.na(treatment), !is.na(Direction)) %>%"
"0","  # Compute circular differences"
"0","  mutate("
"0","    mean_direction_circ = circular(mean_direction, units = ""degrees"", template = ""geographics""),"
"0","    real_direction_circ = circular(real_direction, units = ""degrees"", template = ""geographics"")"
"0","  ) %>%"
"0","  rowwise() %>%"
"0","  mutate("
"0","    signed_diff = as.numeric(mean_direction_circ - real_direction_circ),"
"0","    signed_diff = case_when("
"0","      signed_diff > 180  ~ signed_diff - 360,"
"0","      signed_diff < -180 ~ signed_diff + 360,"
"0","      TRUE ~ signed_diff"
"0","    ),"
"0","    abs_diff = abs(signed_diff)"
"0","  ) %>%"
"0","  ungroup() %>%"
"0","  # Final categorization and factor formatting"
"0","  mutate("
"0","    treatment = factor(treatment, levels = treatment_levels),"
"0","    Species = factor(Species, levels = species_levels),"
"0","    Direction = factor(Direction, levels = direction_levels),"
"0","    group = factor(paste(Direction, Species, treatment, sep = ""_""), levels = group_levels),"
"0","    alpha_val = ifelse(treatment == ""bg"", 0.4, 1)"
"0","  )"
"0",""
"0","# Split into directional subsets"
"0","df_left <- filter(df, real_direction == 270)"
"0","df_right <- filter(df, real_direction == 90)"
"0",""
