"0",""
"0","# Extract scores"
"0","pca_scores <- as.data.frame(res.pca$x)"
"0","pca_scores$Species <- data$Species"
"0",""
"0","# Group centroids"
"0","coord.groups <- get_pca_ind(res.pca)$coord %>%"
"0","  as.data.frame() %>%"
"0","  dplyr::select(Dim.1, Dim.2) %>%"
"0","  mutate(Species = data$Species) %>%"
"0","  group_by(Species) %>%"
"0","  summarise(PC1 = mean(Dim.1), PC2 = mean(Dim.2)) %>%"
"0","   mutate("
"0","    Species_label = species_labels[Species],"
"0","    label = paste0(""PC1 = "", round(PC1, 1), "", PC2 = "", round(PC2, 1))"
"0","  )"
"0",""
"0","# Combine labels into one string"
"0","centroid_text <- paste(coord.groups$Species_label, coord.groups$label, collapse = ""\n"")"
"0",""
"0","# Top 5 contributors and corresponding loadings for PC1 and PC2"
"0","PC1_contrib <- sort(var.contrib[, 1], decreasing = TRUE)[1:5]"
"0","PC2_contrib <- sort(var.contrib[, 2], decreasing = TRUE)[1:5]"
"0",""
"0","PC1_vars <- names(PC1_contrib)"
"0","PC2_vars <- names(PC2_contrib)"
"0",""
"0","PC1_top <- PC1_vars[1]"
"0","PC2_top <- PC2_vars[1]"
"0",""
"0","PC1_loadings <- res.pca$rotation[PC1_vars, 1]"
"0","PC2_loadings <- res.pca$rotation[PC2_vars, 2]"
"0",""
"0","# Format: var (contrib, loading)"
"0","format_vars <- function(vars, contribs, loadings) {"
"0","  paste0(vars, "" ("", round(contribs, 2), "", "", round(loadings, 2), "")"", collapse = "", "")"
"0","}"
"0",""
"0","PC1_str <- format_vars(PC1_vars, PC1_contrib, PC1_loadings)"
"0","PC2_str <- format_vars(PC2_vars, PC2_contrib, PC2_loadings)"
"0",""
"0","# Variance explained"
"0","percentVar <- round(100 * summary(res.pca)$importance[2, 1:2], 1)"
"0",""
"0","# Combine into dataframe"
"0","PCsummary_df <- data.frame("
"0","  PC = c(""PC1"", ""PC2""),"
"0","  `Top Variables (contribution, loading)` = c(PC1_str, PC2_str),"
"0","  `Variance explained (%)` = percentVar,"
"0","  check.names = FALSE"
"0",")"
"0",""
"0","# Output as GT table"
"0","library(gt)"
"0","PC_table <- PCsummary_df %>%"
"0","  gt() %>%"
"0","  tab_header(title = ""Principal Component Summary: Top 5 Variables"") %>%"
"0","  fmt_number(columns = ""Variance explained (%)"", decimals = 1) %>%"
"0","  cols_align(""left"", columns = vars(`Top Variables (contribution, loading)`)) %>%"
"0","  opt_row_striping()"
"0",""
"0","print(PC_table)"
