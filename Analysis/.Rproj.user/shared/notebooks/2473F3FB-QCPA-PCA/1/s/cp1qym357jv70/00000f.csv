"0","format_pvalue <- function(p) {"
"0","  if (is.na(p)) return(""NA"")"
"0","  rounded <- formatC(p, digits = 3, format = ""f"")"
"0","  stars <- if (p < 0.001) {"
"0","    ""***"""
"0","  } else if (p < 0.01) {"
"0","    ""**"""
"0","  } else if (p < 0.05) {"
"0","    ""*"""
"0","  } else if (p < 0.1) {"
"0","    ""."""
"0","  } else {"
"0","    """""
"0","  }"
"0","  paste0(rounded, "" "", stars)"
"0","}"
"0",""
"0","pairwise_tests <- list("
"0","  ""I. Distance"" = c(""Merged_100"", ""Merged_550""),"
"0","  ""II. Motion"" = c(""Merged_550"", ""bg_Merged_clips_sum""),"
"0","  ""III. Patterns"" = c(""bg_Merged_clips_sum"", ""both_Merged_clips_sum"")"
"0",")"
"0",""
"0","for (response_var in vars_to_test) {"
"0","  "
"0","  # Store interaction p-values"
"0","  interaction_ps <- list()"
"0","  "
"0","  for (test_name in names(pairwise_tests)) {"
"0","    test_levels <- pairwise_tests[[test_name]]"
"0","    "
"0","    # Subset to the relevant levels"
"0","    subset_data <- subset(combined_df, test %in% test_levels)"
"0","    subset_data$test <- factor(subset_data$test, levels = test_levels)"
"0","    "
"0","    formula <- as.formula(paste0(""`"", response_var, ""` ~ Species * test""))"
"0","    model <- lm(formula, data = subset_data)"
"0","    "
"0","    aov_res <- car::Anova(model, type = ""II"")"
"0","    interaction_p <- aov_res[""Species:test"", ""Pr(>F)""]"
"0","    interaction_ps[[test_name]] <- interaction_p"
"0","  }"
"0","  "
"0","# Format subtitle text"
"0","subtitle_text <- paste0("
"0","  ""Interaction p-values: "","
"0","  ""I. Distance = "", format_pvalue(interaction_ps[[""I. Distance""]]), ""; "","
"0","  ""II. Motion = "", format_pvalue(interaction_ps[[""II. Motion""]]), ""; "","
"0","  ""III. Patterns = "", format_pvalue(interaction_ps[[""III. Patterns""]])"
"0",")"
"0",""
"0","  # Refit full model for plotting"
"0","  full_model <- lm(as.formula(paste0(""`"", response_var, ""` ~ Species * test"")), data = combined_df)"
"0","  emm <- emmeans(full_model, ~ Species * test)"
"0","  emm_df <- as.data.frame(emm)"
"0","  emm_df$test <- factor(emm_df$test, levels = c(""Merged_100"", ""Merged_550"", ""bg_Merged_clips_sum"", ""both_Merged_clips_sum""))"
"0","  "
"0","  x_labels <- c("
"0","    ""Merged_100"" = ""Stationary at 10cm"","
"0","    ""Merged_550"" = ""Stationary at 55cm"","
"0","    ""bg_Merged_clips_sum"" = ""Moving\n(patterns present)"","
"0","    ""both_Merged_clips_sum"" = ""Moving\n(patterns removed)"""
"0","  )"
"0","  "
"0","  # Plot"
"0","  plot <- ggplot(combined_df, aes(x = test, y = .data[[response_var]], color = Species)) +"
"0","    geom_jitter(width = 0.1, alpha = 0.4, size = 2, color = ""grey60"") +"
"0","    geom_point(data = emm_df, aes(y = emmean), size = 3, position = position_dodge(0.3)) +"
"0","    geom_line(data = emm_df, aes(y = emmean, group = Species), position = position_dodge(0.3)) +"
"0","    geom_errorbar(data = emm_df,"
"0","                  aes(y = emmean, ymin = emmean - SE, ymax = emmean + SE),"
"0","                  width = 0.1, position = position_dodge(0.3)) +"
"0","    scale_x_discrete(labels = x_labels) +"
"0","    scale_color_manual(values = species_colours, labels = species_labels) +"
"0","    labs("
"0","      title = paste(response_var, ""- Combined Interaction Plot""),"
"0","      subtitle = subtitle_text,"
"0","      x = NULL,"
"0","      y = response_var"
"0","    ) +"
"0","    theme_minimal() +"
"0","    theme(legend.position = ""top"", "
"0","          legend.text = element_text(face = ""italic""),"
"0","          plot.subtitle = element_text(size = 10))"
"0","  "
"0","  # Save plot"
"0","  ggsave("
"0","    filename = paste0(""Figures/ColourPatterns/Plots/Combined_"", gsub(""[: ]"", ""_"", response_var), ""_interaction_plot.png""),"
"0","    plot = plot,"
"0","    width = 8, height = 6, dpi = 300"
"0","  )"
"0","}"
"0",""
"0",""
