"0","results <- list()"
"0","frame_by_frame_all <- list()"
"0",""
"0","for (clipname in names(smoothed_trjs)) {"
"0","  trj <- smoothed_trjs[[clipname]]"
"0","  meta_row <- meta_data %>% filter(ClipName == clipname)"
"0",""
"0","  if (nrow(meta_row) == 0 || any(is.na(meta_row$x_pred), is.na(meta_row$y_pred))) next"
"0",""
"0","  pred_pos <- c(meta_row$x_pred, meta_row$y_pred)"
"0",""
"0","  res <- characteriseTrajectory(trj, pred_pos, traj_name = clipname)"
"0",""
"0","  # Add clip name and metadata to frame-by-frame data"
"0","  raw <- res$frame_data %>%"
"0","    mutate(ClipName = clipname) %>%"
"0","    left_join(meta_row, by = ""ClipName"")"
"0",""
"0","  frame_by_frame_all[[clipname]] <- raw"
"0","  results[[clipname]] <- res$summary %>% mutate(ClipName = clipname)"
"0","}"
"0",""
"0","# Combine"
"0","frame_by_frame_df <- bind_rows(frame_by_frame_all)"
"0","summary_df <- bind_rows(results)"
"0",""
"0","# Merge with metadata"
"0","meta_stats <- left_join(meta_data, summary_df, by = ""ClipName"")"
"0",""
"0","# Save optional outputs"
"0","write_csv(frame_by_frame_df, ""CleanData/frame_by_frame_kinematics.csv"")"
