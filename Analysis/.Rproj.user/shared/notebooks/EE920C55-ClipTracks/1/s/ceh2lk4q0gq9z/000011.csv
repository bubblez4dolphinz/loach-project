"0","library(dplyr)"
"0","library(tidyr)"
"0","library(gt)"
"0",""
"0","# Step 1: Create observed table"
"0","observed <- table(meta_stats$Group)"
"0",""
"0","# Step 2: Equal expectations"
"0","expected_even <- rep(sum(observed) / length(observed), length(observed))"
"0","chisq_test_equal <- chisq.test(observed, p = rep(1/length(observed), length(observed)))"
"0","residuals_even <- chisq_test_equal$stdres"
"0",""
"0","chi_table_even <- data.frame("
"0","  Group = names(observed),"
"0","  Observed = as.vector(observed),"
"0","  Expected = as.vector(expected_even),"
"0","  Residuals = round(as.numeric(residuals_even), 2),"
"0","  Test = ""Equal Proportions"""
"0",")"
"0",""
"0","# Step 3: Weighted expectations"
"0","group_counts <- meta_stats %>%"
"0","  dplyr::select(Group, TrialID) %>%"
"0","  dplyr::distinct() %>%"
"0","  dplyr::count(Group, name = ""UniqueTrialCount"") %>%"
"0","  dplyr::filter(Group %in% names(observed)) %>%"
"0","  dplyr::arrange(factor(Group, levels = names(observed)))"
"0",""
"0","expected_prop <- group_counts$UniqueTrialCount / sum(group_counts$UniqueTrialCount)"
"0","expected_weighted <- expected_prop * sum(observed)"
"0",""
"0","chisq_test_weighted <- chisq.test(observed, p = expected_prop)"
"0","residuals_weighted <- chisq_test_weighted$stdres"
"0",""
"0","chi_table_weighted <- data.frame("
"0","  Group = names(observed),"
"0","  Observed = as.vector(observed),"
"0","  Expected = round(expected_weighted, 2),"
"0","  Residuals = round(as.numeric(residuals_weighted), 2),"
"0","  Test = ""Weighted by TrialID"""
"0",")"
"0",""
"0","# Step 4: Combine both chi tables"
"0","chi_full <- bind_rows(chi_table_even, chi_table_weighted)"
"0",""
"0","# Step 5: Add test-level summary (ChiSq, df, p-value)"
"0","summary_long <- data.frame("
"0","  Group = NA,"
"0","  Observed = NA,"
"0","  Expected = NA,"
"0","  Residuals = NA,"
"0","  Test = c(""Equal Proportions"", ""Weighted by TrialID""),"
"0","  ChiSq = c(as.numeric(chisq_test_equal$statistic), as.numeric(chisq_test_weighted$statistic)),"
"0","  df = c(chisq_test_equal$parameter, chisq_test_weighted$parameter),"
"0","  p_value = c(chisq_test_equal$p.value, chisq_test_weighted$p.value)"
"0",")"
"0","summary_reduced <- summary_long %>%"
"0","  select(Test, ChiSq, df, p_value)"
"0",""
"0","# Step 6: Join summary back to main table"
"0","final_table <- chi_full %>%"
"0","  left_join(summary_reduced, by = ""Test"") %>%"
"0","  select(Test, Group, Observed, Expected, Residuals, ChiSq, df, p_value)"
"0",""
"0",""
"0","# Step 7: Clean and prepare the final table for gt"
"0","final_table_cleaned <- final_table %>%"
"0","  arrange(Test, Group) %>%"
"0","  group_by(Test) %>%"
"0","  mutate("
"0","    # Round ChiSq and p_value to 2 decimals before converting to character"
"0","    ChiSq = round(ChiSq, 2),"
"0","    p_value = round(p_value, 2),"
"0","    Test_display = ifelse(row_number() == 1, Test, """"),           # Empty string merges visually"
"0","    ChiSq = ifelse(row_number() == 1, as.character(ChiSq), "" ""),  # Space instead of NA"
"0","    df = ifelse(row_number() == 1, as.character(df), "" ""),"
"0","    p_value = ifelse(row_number() == 1, as.character(p_value), "" "")"
"0","  ) %>%"
"0","  ungroup() %>%"
"0","  select(-Test) %>%                # Remove original Test column"
"0","  rename(Test = Test_display) %>% # Rename Test_display to Test"
"0","  select(Test, ChiSq, df, p_value, everything()) # Reorder columns with Test first"
"0",""
"0","# Create and display the gt table"
"0","gt_table_comb <- final_table_cleaned %>%"
"0","  gt() %>%"
"0","  tab_header(title = ""Chi-squared Test Results by Group"") %>%"
"0","  fmt_number(columns = c(Observed, Expected, Residuals), decimals = 3) %>%"
"0","  cols_label("
"0","    Test = ""Test"","
"0","    ChiSq = ""Chi-sq"","
"0","    df = ""df"","
"0","    p_value = ""p"""
"0","  ) %>%"
"0","  cols_move_to_start(columns = Test)"
"0",""
"0","# Create separate gt table for Equal Proportions"
"0","gt_table_even <- chi_table_even %>%"
"0","  gt() %>%"
"0","  tab_header(title = ""Chi-squared: Equal Proportions"") %>%"
"0","  fmt_number(columns = c(Observed, Expected, Residuals), decimals = 3) %>%"
"0","  cols_label("
"0","    Group = ""Group"","
"0","    Observed = ""Observed"","
"0","    Expected = ""Expected"","
"0","    Residuals = ""Std Residual"""
"0","  )"
"0",""
"0","# Create separate gt table for Weighted Expectations"
"0","gt_table_weighted <- chi_table_weighted %>%"
"0","  gt() %>%"
"0","  tab_header(title = ""Chi-squared: Weighted by TrialID"") %>%"
"0","  fmt_number(columns = c(Observed, Expected, Residuals), decimals = 3) %>%"
"0","  cols_label("
"0","    Group = ""Group"","
"0","    Observed = ""Observed"","
"0","    Expected = ""Expected"","
"0","    Residuals = ""Std Residual"""
"0","  )"
"0",""
"0","# Save as PNG"
"0","gtsave(gt_table_weighted, ""Figures/Kinematics/ Models/Frequency/chi_table_weighted.png"")"
"2","file:///C:/Users/flora/AppData/Local/Temp/RtmpYxNBu6/file11888556a103f.html screenshot completed
"
"0","gtsave(gt_table_even, ""Figures/Kinematics/ Models/Frequency/chi_table_even.png"")"
"2","file:///C:/Users/flora/AppData/Local/Temp/RtmpYxNBu6/file118883a952937.html screenshot completed
"
"0","gtsave(gt_table_comb, ""Figures/Kinematics/ Models/Frequency/chi_table_comb.png"")"
"2","file:///C:/Users/flora/AppData/Local/Temp/RtmpYxNBu6/file1188842e23c1a.html screenshot completed
"
"0","# Display the table object"
"0","gt_table_comb"
