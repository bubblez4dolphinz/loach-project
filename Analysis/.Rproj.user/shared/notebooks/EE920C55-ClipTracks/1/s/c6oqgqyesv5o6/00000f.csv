"0","library(trajr)"
"0","library(ggplot2)"
"0","library(gridExtra)"
"0","library(svglite)"
"0",""
"0","# Create output directory if needed"
"0","out_dir <- ""Figures/Trajectories"""
"0","if (!dir.exists(out_dir)) dir.create(out_dir, recursive = TRUE)"
"0",""
"0","# Loop through each trajectory"
"0","for (i in seq_along(smoothed_trjs)) {"
"0","  trj <- smoothed_trjs[[i]]"
"0","  trj_name <- names(smoothed_trjs)[i]"
"0",""
"0","  # Data frame with x, y, frame"
"0","  df <- trj[, c(""x"", ""y"")]"
"0","  df$frame <- 1:nrow(df)"
"0",""
"0","  # Calculate velocity and convert to speed (magnitude)"
"0","  velocity <- TrajVelocity(trj)"
"0","  df$speed <- Mod(velocity)  # make values positive"
"0",""
"0",""
"0","  # Spatial plot"
"0","  p1 <- ggplot(df, aes(x = x, y = y)) +"
"0","  geom_path(linewidth = 1) +"
"0","  coord_fixed(ratio = 1) +   # fixed 1:1 aspect ratio to keep x,y scales equal"
"0","  theme_minimal() +"
"0","  theme("
"0","    plot.margin = margin(5, 5, 5, 5),"
"0","    panel.spacing = unit(0, ""cm"")"
"0","  ) +"
"0","  labs(title = paste(""Trajectory:"", trj_name),"
"0","       x = ""x (cm)"", y = ""y (cm)"")"
"0",""
"0","p2 <- ggplot(df, aes(x = frame, y = speed)) +"
"0","  geom_line(linewidth = 1, color = ""darkblue"") +"
"0","  theme_minimal() +"
"0","  theme("
"0","    plot.margin = margin(5, 5, 5, 5),"
"0","    panel.spacing = unit(0, ""cm""),"
"0","    aspect.ratio = 1  # fix aspect ratio of speed plot to 1:1 too"
"0","  ) +"
"0","  labs(title = ""Speed over time"","
"0","       x = ""Frame"", y = ""Speed (cm/s)"")"
"0",""
"0","# Combine plots with equal height using patchwork"
"0","combined_plot <- p1 | p2 + plot_layout(widths = c(1, 1), guides = ""collect"") & "
"0","  theme(plot.margin = margin(5, 5, 5, 5))"
"0",""
"0",""
"0","# File names"
"0","png_path <- file.path(out_dir, paste0(trj_name, "".png""))"
"0","svg_path <- file.path(out_dir, paste0(trj_name, "".svg""))"
"0",""
"0","ggsave(png_path, plot = combined_plot, width = 10, height = 5, dpi = 300, bg = ""white"")"
"0","ggsave(svg_path, plot = combined_plot, width = 10, height = 5, device = svglite::svglite)"
"0",""
"0","}"
